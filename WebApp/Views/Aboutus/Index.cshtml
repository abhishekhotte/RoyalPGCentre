<link href="~/css/baguetteBox.min.css" rel="stylesheet" />
<link href="~/css/gallery-grid.css" rel="stylesheet" />
<script src="~/js/baguetteBox.min.js"></script>
<script>
    var operationType = "Add", staffId = 0;;
    $(document).ready(function () {
        $("#ulMenu li").removeClass("menu-active");
        $("#liAboutUs").addClass("menu-active");
        getStaffList();

        $("#btnAddNew").click(function () {
            operationType = "Add";
            clearFormFields();
            $("#divModalheader").text("Add Staff");
            $("#divModal").modal("show");
        });

        $("#photoUpload").click(function () {
            $("#fileUpload").click().change(function () {
                var reader = new FileReader();
                reader.onload = function () {
                    $("#photoUpload").attr("src", reader.result);
                };
                reader.readAsDataURL(event.target.files[0]);
            })

        });

        $("#btnSaveStaff").click(function () {
            let name = "", designation = "", mobile = "", email = "", teachingStaff = false;
            name = $("#txtName").val();
            designation = $("#txtDesignation").val();
            mobile = $("#txtMobileNo").val();
            email = $("#txtEmailId").val();
            image = $("#photoUpload").attr("src");
            //teachingStaff = $("#rdbTeachingStaff").is(":checked");
            checkIfFieldEmpty();
            if (name == "") {
                showAlertDialog("warning", "Please enter Staff Name");
                $("#txtName").focus();
            }
            else if (designation == "") {
                showAlertDialog("warning", "Please enter Staff Designation"); $("#txtDesignation").focus();
            }
            else if (mobile == "") {
                showAlertDialog("warning", "Please enter Staff Mobile no"); $("#txtMobileNo").focus();
            }
            else if (email == "") {
                showAlertDialog("warning", "Please enter Staff Email Id"); $("#txtEmailId").focus();
            }
            else {
                showLoader();
                $("#divModal").modal("hide");
                var formData = new FormData();
                var file = document.getElementById("fileUpload");
                formData.append("fileUpload", file);
                $.ajax({
                    dataType: "json",
                    type: "post",
                    url: '/AboutUs/AddUpdateStaff',
                    data: {
                        id:staffId,
                        name: name,
                        designation: designation,
                        mobile: mobile,
                        email: email,
                        image:image
                    },
                    success: function (data) {
                        if (data.result == "success") {
                            if (operationType == "Add") {
                                showAlertDialog("success", "Added Successfully");
                                profileHtml = "<div id='staff" + data.staffId + "' class='col-lg-3 col-md-4 col-sm-6 col-xs-12 wow zoomIn fadeInUp filter-teaching-staff'><div class='panel panel-default'><div class='panel-body profile'><i class='fa fa-edit staff-edit-icon' data-staff-id='" + data.staffId + "' title='Edit'></i><div class='profile-image'><img id='liSImg" + data.staffId + "' src='/images/staff/" + data.staffId + ".jpg' alt=''></div></div><div class='panel-body'><div class='contact-info'><div class='profile-data-name' id='liSName" + data.staffId + "'>" + name + "</div><div class='profile-data-title' id='liSDesignation" + data.staffId + "'>" + designation + "</div><div class='profile-data-title'><span class='fa-phone fa fa-lg profile-icon'></span><span id='liSMobile" + data.staffId + "'>" + mobile + "</span></div><div class='profile-data-title'><span class='fa-envelope-o fa fa-lg profile-icon'></span><span id='liSEmail" + data.staffId + "'>" + email + "</span></div></div></div></div></div>";
                                $("#divProfileContent").append(profileHtml);
                                editStaffList();
                            }
                            else {
                                showAlertDialog("success", "Updated Successfully");
                                $("#liSName" + staffId).text(name)
                                $("#liSDesignation" + staffId).text(designation)
                                $("#liSMobile" + staffId).text(mobile)
                                $("#liSEmail" + staffId).text(email)
                                setTimeout(function () {
                                    $("#liSImg" + staffId).attr("src", image);
                                },1000)
                            }
                        }
                        hideLoader();
                    },
                    error: function (error) {
                        showAlertDialog("success", "Unable to update Staff details");
                        hideLoader();
                    }
                });
            }
        });

        //Gallery content
        getCollegePhotos();
        $("#galleryUpload").change(function () {
            var file = this.files;
            var notImage = false;
            for (var i = 0; i < this.files.length; i++) {
                var fileType = file[i]["type"];
                var ValidImageTypes = ["image/jpeg", "image/png"];
                if ($.inArray(fileType, ValidImageTypes) < 0) {
                    notImage = true;
                    showWarningStatus("Please select JPEG/JPG and PNG images only");
                    $("#galleryUpload").val("");
                    return;
                }
            }
        })

        $("#btnGalleryUpload").click(function () {
            var fileUpload = $("#galleryUpload").get(0);
            var files = fileUpload.files;
            if (files.length > 0) {
                // Create FormData object
                var fileData = new FormData();

                // Looping over all files and add it to FormData object
                for (var i = 0; i < files.length; i++) {
                    fileData.append(files[i].name, files[i]);
                }
                showLoader();
                $.ajax({
                    url: '/AboutUs/UploadCollegePhotos',
                    type: 'POST',
                    data: fileData,
                    success: function (data) {
                        if (data.result == "success") {
                            showAlertDialog("success", "Image uploaded successfully");
                            $("#galleryUpload").val("");
                            setTimeout(function () {
                                getCollegePhotos();
                            }, 2000)
                        }
                        else {
                            showAlertDialog("warning", "Unable to upload gallery photo(s)");
                        }
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });
            }
            else {
                $("#galleryUpload").focus();
                showAlertDialog("warning", "Please select images");
            }

        });

    });

    function clearFormFields() {
        $(".form-control").val("").removeClass("is-invalid");
        $("#photoUpload").attr("src", "/images/no-image.jpg");
        setTimeout(function () {
            $("#txtName").focus();
        }, 200);
    }

    function getStaffList() {
        showLoader();
        $.ajax({
            type: "POST",
            url: '/AboutUs/GetAllStaffDetails',
            dataType: 'json',
            contentType: false,
            processData: false,
            success: function (data) {
                $("#divProfileContent").html(data.list);
                editStaffList();
                hideLoader();
            },
            error: function (error) {
                showAlertDialog("success", "Unable to get Staff details");
                hideLoader();
            }
        });

    }

    function editStaffList() {
        $(".staff-edit-icon").click(function () {
            clearFormFields();
            staffId = $(this).data("staff-id");
            $("#txtName").val($("#liSName" + staffId).text());
            $("#txtDesignation").val($("#liSDesignation" + staffId).text());
            $("#txtMobileNo").val($("#liSMobile" + staffId).text());
            $("#txtEmailId").val($("#liSEmail" + staffId).text());
            $("#photoUpload").attr("src", $("#liSImg" + staffId).attr("src"));
            operationType = "Edit";
            $("#divModalheader").text("Edit Staff");
            $("#divModal").modal("show");
        });
    }

    function getCollegePhotos() {
        showLoader();
        $.ajax({
            url: '/AboutUs/GetCollegePhotos',
            type: 'POST',
            success: function (data) {
                if (data.result == "success") {
                    $("#divCollegeGallery").html(data.images);
                    baguetteBox.run('.tz-gallery');
                }
                else {
                    showAlertDialog("warning", "Unable to upload gallery photo(s)");
                }
                hideLoader();
            },
        });
    }
</script>

<div id="aboutus" class="container">
    <div class="primary-box">
        <h3><i class="ion-ios-people-outline icon"></i>Our Staff
           @if (User.Identity.IsAuthenticated)
           {
            <input type="button" value="Add New" id="btnAddNew" class="btn btn-success pull-right" />
           }
        </h3>
        <div>
            <div class="row" id="divProfileContent">
                @*<div id="staff{0}" class="col-lg-3 col-md-4 col-sm-6 col-xs-12 wow fadeInUp filter-teaching-staff">
                    <!-- CONTACT ITEM -->
                    <div class="panel panel-default">
                        <div class="panel-body profile">
                            <div class="profile-image">
                                <img src="~/images/staff{1}" alt="">
                            </div>
                            {6}
                        </div>
                        <div class="panel-body">
                            <div class="contact-info">
                                <div class="profile-data-name">{2}</div>
                                <div class="profile-data-title">{3}</div>
                                <div class="profile-data-title">
                                    <span class="fa-phone fa fa-lg profile-icon">
                                    </span>
                                    <span>{4}</span>
                                </div>
                                <div class="profile-data-title">
                                    <span class="fa-envelope-o fa fa-lg profile-icon">
                                    </span>
                                    {5}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END CONTACT ITEM -->
                </div>*@
            </div>
        </div>
    </div>
    <br />
    <div class="primary-box">
        <h3>
            <i class="ion-ios-people-outline icon"></i>Our College
            @if (User.Identity.IsAuthenticated)
            {
                <div class="pull-right">
                    <form id="formUpload" method="post"></form>
                    <table>
                        <tr>
                            <td>
                                <input type="file" name="galleryUpload" value="" id="galleryUpload" class="form-control" multiple accept="image/*" />
                            </td>
                            <td>
                                &nbsp;

                                <button id="btnGalleryUpload" type="submit" class="btn btn-success" title="Upload File">
                                    Upload
                                </button>
                            </td>
                        </tr>
                    </table>
                </div>
            }
        </h3>
      
        <div class="tz-gallery">
            <div class="row" id="divCollegeGallery">
            </div>
            <br />
        </div>
    </div>
</div>


<div class="modal" id="divModal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="divModalheader">Add</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="divModalBody">
                <div class="form-group">
                    <div class="col-md-9">
                        <div class="form-group row">
                            <label for="" class="col-sm-3 col-form-label">Name</label>
                            <div class="col-sm-9">
                                <input type="text" name="" value="" class="form-control mandatory-field" id="txtName"  maxlength="50" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="" class="col-sm-3 col-form-label">Designation</label>
                            <div class="col-sm-9">
                                <input type="text" name="" value="" class="form-control mandatory-field" id="txtDesignation" maxlength="50" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="" class="col-sm-3 col-form-label">Mobile No</label>
                            <div class="col-sm-9">
                                <input type="text" name="" value="" class="form-control mandatory-field" id="txtMobileNo" maxlength="50" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="" class="col-sm-3 col-form-label">Email Id</label>
                            <div class="col-sm-9">
                                <input type="text" name="" value="" class="form-control mandatory-field" id="txtEmailId"  maxlength="50" />
                            </div>
                        </div>
                        @*<div class="form-group row">
                            <label for="" class="col-sm-3 col-form-label">Teaching Staff</label>
                            <div class="col-sm-9">
                                <div class="form-group" >
                                    <label class="radio-inline"><input type="radio" id="rdbTeachingStaff" name="optradio"  tabindex="0" checked>Yes</label>
                                    <label class="radio-inline"><input type="radio" id="rdbNonTeachingStaff" name="optradio"  tabindex="0">No</label>
                                </div>
                            </div>
                        </div>*@
                    </div>
                    <div class="col-md-3 " style="text-align:center">
                        <img id="photoUpload" src="~/images/no-image.jpg" class="staff-img-update" alt="" title="Upload Photo" />
                        <input type="file" style="display:none" name="name" value=""  accept=".png, .jpg, .jpeg"  id="fileUpload"/>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="btnSaveStaff" class="btn btn-outline-success btn-lg">Save changes</button>
                <button type="button"  class="btn btn-outline-info btn-lg" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>